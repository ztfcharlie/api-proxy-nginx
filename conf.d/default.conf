# HTTP - 所有请求跳转到HTTPS www
server {
    listen 80;
    server_name *.burncloud.cn burncloud.cn;

    # Let's Encrypt验证路径
    location /.well-known/acme-challenge/ {
        root /var/www/html;
        try_files $uri =404;
    }

    # 健康检查
    location /health {
        return 200 'OK';
        add_header Content-Type text/plain;
    }

    # 统一跳转到HTTPS www
    location / {
        return 301 https://www.burncloud.cn$request_uri;
    }
}

# HTTPS - www.burncloud.cn 主站
server {
    server_name www.burncloud.cn;
    include ssl.conf;

    location / {
        root /var/www/html;
        index index.html index.htm;
        try_files $uri $uri/ =404;
    }
}

# HTTPS - 其他子域名跳转到www
server {
    server_name *.burncloud.cn burncloud.cn;
    include ssl.conf;

    # 排除www（避免冲突）
    if ($host = "www.burncloud.cn") {
        return 444; # 关闭连接
    }

    # 跳转到www
    return 301 https://www.burncloud.cn$request_uri;
}

