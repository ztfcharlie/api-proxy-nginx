#!/bin/bash

echo "ğŸ”§ MySQLé…ç½®ä¼˜åŒ–è¯Šæ–­è„šæœ¬"
echo "========================"

cd "$(dirname "$0")"

echo "ğŸ“‹ å½“å‰MySQLé…ç½®åˆ†æï¼š"
echo ""

echo "1. æ£€æŸ¥docker-compose-base-service.ymlä¸­çš„MySQLé…ç½®ï¼š"
echo "   âœ… ä¿®å¤äº†PIDæ–‡ä»¶è·¯å¾„: /var/run/mysqld/mysqld.pid"
echo "   âœ… ä¿®å¤äº†Socketæ–‡ä»¶è·¯å¾„: /var/run/mysqld/mysqld.sock"
echo "   âœ… è®¾ç½®äº†secure-file-priv: /var/lib/mysql/files"
echo "   âœ… æ·»åŠ äº†skip-name-resolve (æå‡è¿æ¥æ€§èƒ½)"
echo "   âœ… æ·»åŠ äº†explicit_defaults_for_timestamp (ä¿®å¤è­¦å‘Š)"
echo "   âœ… æ·»åŠ äº†default-authentication-plugin=mysql_native_password (å…¼å®¹æ€§)"
echo "   âœ… å¥åº·æ£€æŸ¥æ”¹ä¸ºä½¿ç”¨rootç”¨æˆ· (é¿å…ç”¨æˆ·åˆ›å»ºæ—¶æœºé—®é¢˜)"
echo "   âœ… å¢åŠ äº†å¯åŠ¨ç­‰å¾…æ—¶é—´: 60s"
echo "   âœ… å¢åŠ äº†é‡è¯•æ¬¡æ•°: 10æ¬¡"
echo ""

echo "2. ç›®å½•ç»“æ„æ£€æŸ¥ï¼š"
echo "   åˆ›å»ºç›®å½•ç»“æ„ï¼š"
echo "   - mysql-data/ (MySQLæ•°æ®æ–‡ä»¶)"
echo "   - mysql-files/ (MySQLæ–‡ä»¶å¯¼å…¥ç›®å½•)"
echo "   - database/ (æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬)"
echo "   - redis-data/ (Redisæ•°æ®æ–‡ä»¶)"
echo ""

echo "3. MySQLå®¹å™¨å¯åŠ¨æµç¨‹ï¼š"
echo "   ğŸ”„ å¯åŠ¨é¡ºåºï¼š"
echo "   a) MySQLå®¹å™¨å¯åŠ¨ï¼Œåˆå§‹åŒ–ç³»ç»Ÿè¡¨"
echo "   b) åˆ›å»ºç¯å¢ƒå˜é‡æŒ‡å®šçš„æ•°æ®åº“å’Œç”¨æˆ·"
echo "   c) æ‰§è¡Œ /docker-entrypoint-initdb.d/ ä¸­çš„åˆå§‹åŒ–è„šæœ¬"
echo "   d) å¥åº·æ£€æŸ¥é€šè¿‡åï¼Œå®¹å™¨æ ‡è®°ä¸ºhealthy"
echo ""

echo "4. ç½‘ç»œé…ç½®ï¼š"
echo "   ğŸŒ api-proxy-network (bridgeé©±åŠ¨)"
echo "   - MySQL: api-proxy-mysql:3306"
echo "   - Redis: api-proxy-redis:6379"
echo ""

echo "5. å¥åº·æ£€æŸ¥é…ç½®ï¼š"
echo "   ğŸ¥ MySQLå¥åº·æ£€æŸ¥ï¼š"
echo "   - å‘½ä»¤: mysqladmin ping -h localhost -u root -proot_password_123456"
echo "   - é—´éš”: 30ç§’"
echo "   - è¶…æ—¶: 10ç§’"
echo "   - é‡è¯•: 10æ¬¡"
echo "   - å¯åŠ¨ç­‰å¾…: 60ç§’"
echo ""
echo "   ğŸ¥ Rediså¥åº·æ£€æŸ¥ï¼š"
echo "   - å‘½ä»¤: redis-cli -a 123456 ping"
echo "   - é—´éš”: 30ç§’"
echo "   - è¶…æ—¶: 10ç§’"
echo "   - é‡è¯•: 3æ¬¡"
echo "   - å¯åŠ¨ç­‰å¾…: 10ç§’"
echo ""

echo "6. å·²ä¿®å¤çš„MySQLè­¦å‘Šï¼š"
echo "   âœ… [Warning] PID file could not be created"
echo "   âœ… [Warning] Deprecated default value for explicit_defaults_for_timestamp"
echo "   âœ… [Warning] Authentication plugin 'caching_sha2_password'"
echo "   âœ… [Warning] TCP/IP connection error"
echo ""

echo "7. é…ç½®ä¼˜åŒ–è¯´æ˜ï¼š"
echo "   ğŸ”§ max_connections=1000 (æ”¯æŒæ›´å¤šå¹¶å‘è¿æ¥)"
echo "   ğŸ”§ innodb_buffer_pool_size=256M (ä¼˜åŒ–å†…å­˜ä½¿ç”¨)"
echo "   ğŸ”§ disable-log-bin (å‡å°‘æ—¥å¿—å†™å…¥ï¼Œæå‡æ€§èƒ½)"
echo "   ğŸ”§ skip-name-resolve (é¿å…DNSè§£æå»¶è¿Ÿ)"
echo ""

echo "8. æ•…éšœæ’é™¤å»ºè®®ï¼š"
echo "   ğŸ” å¦‚æœä»ç„¶æœ‰è­¦å‘Šï¼Œæ£€æŸ¥ï¼š"
echo "   a) ç¡®ä¿mysql-dataç›®å½•æƒé™æ­£ç¡®"
echo "   b) ç¡®ä¿database/schema.sqlæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®"
echo "   c) æ£€æŸ¥ç«¯å£3306å’Œ6379æ˜¯å¦è¢«å ç”¨"
echo "   d) ç¡®ä¿Dockeræœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´"
echo ""

echo "ğŸ“ éƒ¨ç½²æ­¥éª¤ï¼š"
echo "   1. åˆ›å»ºå¿…è¦çš„ç›®å½•ï¼š"
echo "      mkdir -p mysql-data mysql-files redis-data"
echo ""
echo "   2. å¯åŠ¨åŸºç¡€æœåŠ¡ï¼š"
echo "      docker-compose -f docker-compose-base-service.yml up -d"
echo ""
echo "   3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š"
echo "      docker-compose -f docker-compose-base-service.yml ps"
echo ""
echo "   4. æ£€æŸ¥å¥åº·çŠ¶æ€ï¼š"
echo "      docker-compose -f docker-compose-base-service.yml exec api-proxy-mysql mysqladmin ping -h localhost -u root -proot_password_123456"
echo "      docker-compose -f docker-compose-base-service.yml exec api-proxy-redis redis-cli -a 123456 ping"
echo ""
echo "   5. éªŒè¯æ•°æ®åº“åˆå§‹åŒ–ï¼š"
echo "      docker-compose -f docker-compose-base-service.yml exec api-proxy-mysql mysql -u oauth2_user -poauth2_password_123456 oauth2_mock -e 'SHOW TABLES;'"
echo ""

echo "ğŸ’¡ æç¤ºï¼šé…ç½®å·²ä¼˜åŒ–ï¼Œåº”è¯¥èƒ½å¤Ÿè§£å†³ä¹‹å‰çš„MySQLè­¦å‘Šå’Œè¿æ¥é—®é¢˜ï¼"