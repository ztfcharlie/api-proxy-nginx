# ç›®å½•ç»“æ„ä¼˜åŒ–è¯´æ˜

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

å°†æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ç§»åŠ¨åˆ°Node.jsæœåŠ¡ç›®å½•ä¸‹ï¼Œå®ç°æ›´å¥½çš„èŒè´£åˆ†ç¦»å’Œé¡¹ç›®ç»„ç»‡ã€‚

## ğŸ“ ä¼˜åŒ–å‰çš„ç»“æ„

```
D:\www\nginxzhuanfa\end\
â”œâ”€â”€ database\                    # âŒ åœ¨æ ¹ç›®å½•ï¼ŒèŒè´£ä¸æ¸…æ™°
â”‚   â””â”€â”€ schema.sql
â”œâ”€â”€ nodejs\
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ server\
â”œâ”€â”€ nginx\
â”œâ”€â”€ logs\
â”œâ”€â”€ docker-compose.yml           # ä¸»é¡¹ç›®ä¸éœ€è¦database
â””â”€â”€ ...
```

### å­˜åœ¨çš„é—®é¢˜
1. **èŒè´£ä¸æ¸…æ™°**: databaseå±äºNode.js OAuth2æœåŠ¡ï¼Œå´åœ¨é¡¹ç›®æ ¹ç›®å½•
2. **ä¾èµ–å…³ç³»æ··ä¹±**: ä¸»é¡¹ç›®çš„docker-compose.ymlä¸ä¾èµ–databaseç›®å½•
3. **ç»´æŠ¤å›°éš¾**: Node.jsæœåŠ¡ç›¸å…³æ–‡ä»¶åˆ†æ•£åœ¨ä¸åŒä½ç½®
4. **éƒ¨ç½²å¤æ‚æ€§**: éœ€è¦è®°ä½è·¨ç›®å½•çš„æ–‡ä»¶å…³ç³»

## ğŸ“ ä¼˜åŒ–åçš„ç»“æ„

```
D:\www\nginxzhuanfa\end\
â”œâ”€â”€ nodejs\                      # âœ… Node.jsæœåŠ¡å®Œæ•´ç›®å½•
â”‚   â”œâ”€â”€ database\               # âœ… æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â””â”€â”€ schema.sql
â”‚   â”œâ”€â”€ docker-compose.yml      # âœ… æœåŠ¡ç¼–æ’
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ server\
â”‚   â”‚   â”œâ”€â”€ app.js
â”‚   â”‚   â”œâ”€â”€ routes\
â”‚   â”‚   â”œâ”€â”€ services\
â”‚   â”‚   â”œâ”€â”€ middleware\
â”‚   â”‚   â””â”€â”€ utils\
â”‚   â””â”€â”€ logs/
â”œâ”€â”€ nginx\                      # OpenRestyé…ç½®
â”‚   â””â”€â”€ conf.d\
â”œâ”€â”€ mysql-data\                 # æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ redis-data\                 # RedisæŒä¹…åŒ–
â”œâ”€â”€ logs\                       # å…±äº«æ—¥å¿—
â”œâ”€â”€ docker-compose.yml          # ä¸»é¡¹ç›®ç¼–æ’
â””â”€â”€ ...
```

## âœ… ä¼˜åŒ–å¸¦æ¥çš„å¥½å¤„

### 1. **èŒè´£æ¸…æ™°**
- Node.jsæœåŠ¡ç›¸å…³æ–‡ä»¶å…¨éƒ¨é›†ä¸­åœ¨`nodejs/`ç›®å½•
- æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ä¸Node.jsæœåŠ¡åœ¨åŒä¸€å±‚çº§
- æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ã€å®Œæ•´çš„æ¨¡å—

### 2. **ä¾èµ–å…³ç³»æ˜ç¡®**
```yaml
# nodejs/docker-compose.yml
api-proxy-mysql:
  volumes:
    - ./database:/docker-entrypoint-initdb.d:ro  # ç›¸å¯¹è·¯å¾„ï¼Œæ¸…æ™°æ˜äº†
```

### 3. **ç»´æŠ¤ç®€ä¾¿**
- ä¿®æ”¹æ•°æ®åº“ç»“æ„åªéœ€åœ¨`nodejs/database/`ç›®å½•æ“ä½œ
- éƒ¨ç½²Node.jsæœåŠ¡æ—¶ï¼Œæ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½åœ¨åŒä¸€ç›®å½•
- ç‰ˆæœ¬æ§åˆ¶å’Œå¤‡ä»½æ›´åŠ ç®€å•

### 4. **éƒ¨ç½²ç®€åŒ–**
- å¯ä»¥ç‹¬ç«‹éƒ¨ç½²Node.jsæœåŠ¡æ ˆ
- å‡å°‘è·¨ç›®å½•ä¾èµ–
- Docker Composeè·¯å¾„æ›´ç®€æ´

### 5. **æ‰©å±•æ€§æ›´å¥½**
- æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ›´å¤šæ•°æ®åº“ç›¸å…³æ–‡ä»¶
- æ”¯æŒæ•°æ®åº“ç‰ˆæœ¬è¿ç§»è„šæœ¬
- ä¾¿äºæ·»åŠ æµ‹è¯•æ•°æ®å’Œå¼€å‘æ•°æ®

## ğŸ”„ è¿ç§»æ­¥éª¤

### å·²å®Œæˆçš„æ“ä½œ
1. âœ… åˆ›å»º`nodejs/database/`ç›®å½•
2. âœ… å¤åˆ¶`schema.sql`åˆ°æ–°ä½ç½®
3. âœ… ä¿®æ”¹`docker-compose.yml`ä¸­çš„æŒ‚è½½è·¯å¾„
4. âœ… æ›´æ–°ç›¸å…³æ–‡æ¡£

### è·¯å¾„å˜æ›´å¯¹æ¯”
```yaml
# ä¼˜åŒ–å‰
volumes:
  - ../database:/docker-entrypoint-initdb.d:ro

# ä¼˜åŒ–å
volumes:
  - ./database:/docker-entrypoint-initdb.d:ro
```

## ğŸš€ éƒ¨ç½²å½±å“

### æ— éœ€é¢å¤–æ“ä½œ
- å¦‚æœ`mysql-data`ç›®å½•å·²å­˜åœ¨ä¸”åŒ…å«æ•°æ®ï¼Œ**ä¸ä¼šé‡æ–°åˆå§‹åŒ–**
- MySQLå®¹å™¨ä¼šæ£€æµ‹åˆ°æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–è„šæœ¬

### é¦–æ¬¡éƒ¨ç½²
```bash
cd nodejs
docker-compose up -d
# è‡ªåŠ¨ä½¿ç”¨ ./database/schema.sql åˆå§‹åŒ–æ•°æ®åº“
```

### é‡æ–°åˆå§‹åŒ–ï¼ˆå¦‚éœ€è¦ï¼‰
```bash
cd nodejs
docker-compose down
rm -rf ../mysql-data/
docker-compose up -d
# ä½¿ç”¨æ–°çš„ ./database/schema.sql é‡æ–°åˆå§‹åŒ–
```

## ğŸ“‹ éªŒè¯æ¸…å•

- [ ] `nodejs/database/schema.sql` æ–‡ä»¶å­˜åœ¨
- [ ] `docker-compose.yml` æŒ‚è½½è·¯å¾„å·²æ›´æ–°ä¸º `./database`
- [ ] æ•°æ®åº“åˆå§‹åŒ–åŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰Dockeré…ç½®è¯­æ³•æ­£ç¡®
- [ ] ç›¸å…³æ–‡æ¡£å·²æ›´æ–°

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
```
nodejs/database/
â”œâ”€â”€ schema.sql              # åŸºç¡€ç»“æ„
â”œâ”€â”€ migrations/             # ç‰ˆæœ¬è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ 001_initial.sql
â”‚   â”œâ”€â”€ 002_add_indexes.sql
â”‚   â””â”€â”€ 003_add_views.sql
â”œâ”€â”€ seeds/                  # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ development.sql
â”‚   â””â”€â”€ test.sql
â””â”€â”€ backup/                 # å¤‡ä»½è„šæœ¬
    â””â”€â”€ backup.sh
```

### 2. ç¯å¢ƒç‰¹å®šé…ç½®
```
nodejs/database/
â”œâ”€â”€ schema.sql
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ development.sql
â”œâ”€â”€ testing.sql
â”‚   â””â”€â”€ production.sql
```

### 3. ç›‘æ§å’Œç»´æŠ¤
```
nodejs/database/
â”œâ”€â”€ schema.sql
â”œâ”€â”€ maintenance/
â”‚   â”œâ”€â”€ cleanup.sql
â”‚   â”œâ”€â”€ performance_optimization.sql
â”‚   â””â”€â”€ health_checks.sql
```

---

**æ€»ç»“**: é€šè¿‡å°†databaseç›®å½•ç§»åŠ¨åˆ°nodejsç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å®ç°äº†æ›´å¥½çš„é¡¹ç›®ç»„ç»‡ç»“æ„ï¼Œä½¿æ¯ä¸ªæœåŠ¡æ¨¡å—æ›´åŠ ç‹¬ç«‹å’Œå®Œæ•´ï¼ŒåŒæ—¶ç®€åŒ–äº†éƒ¨ç½²å’Œç»´æŠ¤æµç¨‹ã€‚