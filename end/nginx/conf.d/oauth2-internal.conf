# OAuth2内部代理配置
# 这个配置文件提供内部OAuth2请求支持

# 内部OAuth2代理location
location /internal/oauth2 {
    internal;

    # 代理到Google OAuth2端点
    proxy_pass https://oauth2.googleapis.com/token;

    # 设置代理头部
    proxy_set_header Host oauth2.googleapis.com;
    proxy_set_header Content-Type application/x-www-form-urlencoded;
    proxy_set_header User-Agent "OpenResty-OAuth2-Client/1.0";

    # SSL设置
    proxy_ssl_verify on;
    proxy_ssl_verify_depth 2;
    proxy_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;

    # 超时设置
    proxy_connect_timeout 30s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;

    # 不缓冲请求和响应
    proxy_request_buffering off;
    proxy_buffering off;

    # 传递请求体
    proxy_pass_request_body on;
    proxy_pass_request_headers off;
}