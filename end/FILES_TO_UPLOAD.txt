# ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶æ¸…å•

## âœ… å¿…éœ€æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰

### Docker é…ç½®
â–¡ Dockerfile.new                      # æ–°çš„ Dockerfile
â–¡ docker compose.new.yml              # æ–°çš„ docker compose é…ç½®

### éƒ¨ç½²è„šæœ¬
â–¡ deploy.sh                           # ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆéœ€è¦ chmod +xï¼‰

### Nginx é…ç½®
â–¡ nginx/nginx.conf                    # Nginx ä¸»é…ç½®
â–¡ nginx/conf.d/gemini-proxy.conf      # ä»£ç†æœåŠ¡å™¨é…ç½®

### Lua è„šæœ¬
â–¡ lua/config.lua                      # é…ç½®ç®¡ç†æ¨¡å—
â–¡ lua/utils.lua                       # å·¥å…·å‡½æ•°æ¨¡å—
â–¡ lua/auth_manager.lua                # OAuth2 è®¤è¯ç®¡ç†æ¨¡å—
â–¡ lua/stream_handler.lua              # æµå¼è¯·æ±‚å¤„ç†æ¨¡å—

### é…ç½®æ–‡ä»¶
â–¡ data/map/map-config.json            # ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰
â–¡ data/json/*.json                    # Google æœåŠ¡è´¦å·å‡­è¯æ–‡ä»¶
â–¡ config/app_config.json              # åº”ç”¨é…ç½®ï¼ˆå¯é€‰ï¼‰

## ğŸ“š æ–‡æ¡£æ–‡ä»¶ï¼ˆæ¨èï¼‰

â–¡ README_DEPLOYMENT.md                # éƒ¨ç½²æ–‡æ¡£æ€»è§ˆ
â–¡ SERVER_DEPLOYMENT.md                # å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆæ¨èï¼‰
â–¡ PRE_DEPLOYMENT_CHECKLIST.md         # éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•
â–¡ DEPLOYMENT_GUIDE.md                 # è¯¦ç»†éƒ¨ç½²æŒ‡å—
â–¡ data/map/README-NEW-CONFIG.md       # é…ç½®æ–‡ä»¶è¯´æ˜
â–¡ TESTING_CHECKLIST.md                # æµ‹è¯•æ£€æŸ¥æ¸…å•

## ğŸ§ª æµ‹è¯•è„šæœ¬ï¼ˆå¯é€‰ï¼‰

â–¡ test-new-config.sh                  # API æµ‹è¯•è„šæœ¬
â–¡ test_lua_modules.sh                 # Lua æ¨¡å—æµ‹è¯•è„šæœ¬
â–¡ check_lua_syntax.sh                 # è¯­æ³•æ£€æŸ¥è„šæœ¬

## ğŸ“ ç›®å½•ç»“æ„ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºï¼‰

ä»¥ä¸‹ç›®å½•ä¼šåœ¨éƒ¨ç½²æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œä¸éœ€è¦ä¸Šä¼ ï¼š
- logs/                               # æ—¥å¿—ç›®å½•
- data/jwt/                           # Token ç¼“å­˜ç›®å½•
- redis-data/                         # Redis æ•°æ®ç›®å½•

## ğŸš« ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶ä¸éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š
- Dockerfileï¼ˆæ—§ç‰ˆæœ¬ï¼‰
- docker compose.ymlï¼ˆæ—§ç‰ˆæœ¬ï¼‰
- tests/                              # æœ¬åœ°æµ‹è¯•æ–‡ä»¶
- .git/                               # Git ä»“åº“
- *.log                               # æ—¥å¿—æ–‡ä»¶
- data/jwt/*.json                     # Token ç¼“å­˜
- redis-data/                         # Redis æ•°æ®

## ğŸ“¦ æ‰“åŒ…å‘½ä»¤

### æ–¹æ³• 1: ä½¿ç”¨ tarï¼ˆæ¨èï¼‰

```bash
# åœ¨ D:\www\nginxzhuanfa ç›®å½•ä¸‹
cd D:\www\nginxzhuanfa

# æ‰“åŒ…æ•´ä¸ª end ç›®å½•
tar -czf end.tar.gz end/

# æˆ–è€…åªæ‰“åŒ…å¿…éœ€æ–‡ä»¶ï¼ˆæ›´å°ï¼‰
tar -czf end-minimal.tar.gz \
  end/Dockerfile.new \
  end/docker compose.new.yml \
  end/deploy.sh \
  end/nginx/ \
  end/lua/ \
  end/data/map/ \
  end/data/json/ \
  end/config/ \
  end/*.md \
  end/*.sh
```

### æ–¹æ³• 2: ä½¿ç”¨ 7-Zipï¼ˆWindowsï¼‰

1. å³é”®ç‚¹å‡» `end` æ–‡ä»¶å¤¹
2. é€‰æ‹© "7-Zip" -> "æ·»åŠ åˆ°å‹ç¼©åŒ…..."
3. å‹ç¼©æ ¼å¼é€‰æ‹© "tar.gz"
4. ç‚¹å‡»ç¡®å®š

## ğŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨

### ä½¿ç”¨ SCP

```bash
scp end.tar.gz user@your-server-ip:/home/user/
```

### ä½¿ç”¨ SFTP å·¥å…·

- FileZilla
- WinSCP
- MobaXterm

## âœ… éªŒè¯ä¸Šä¼ 

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh user@your-server-ip

# æ£€æŸ¥æ–‡ä»¶
ls -lh /home/user/end.tar.gz

# è§£å‹
cd /home/user
tar -xzf end.tar.gz

# éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
cd end
ls -la Dockerfile.new docker compose.new.yml deploy.sh
ls -la data/map/map-config.json
ls -la data/json/
```

## ğŸ“‹ æ–‡ä»¶å¤§å°å‚è€ƒ

- å®Œæ•´æ‰“åŒ…: ~50-100MBï¼ˆåŒ…å«æ–‡æ¡£å’Œæµ‹è¯•è„šæœ¬ï¼‰
- æœ€å°æ‰“åŒ…: ~10-20MBï¼ˆä»…æ ¸å¿ƒæ–‡ä»¶ï¼‰
- ä¸»è¦å ç”¨: data/json/*.jsonï¼ˆæœåŠ¡è´¦å·æ–‡ä»¶ï¼‰

## ğŸ” æ£€æŸ¥æ¸…å•

ä¸Šä¼ å‰ç¡®è®¤ï¼š
â–¡ æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å·²åŒ…å«
â–¡ map-config.json æ ¼å¼æ­£ç¡®
â–¡ æœåŠ¡è´¦å·æ–‡ä»¶å­˜åœ¨ä¸”æœ‰æ•ˆ
â–¡ deploy.sh æœ‰æ‰§è¡Œæƒé™ï¼ˆchmod +xï¼‰
â–¡ æ–‡æ¡£æ–‡ä»¶å·²åŒ…å«ï¼ˆæ–¹ä¾¿æŸ¥é˜…ï¼‰

ä¸Šä¼ åç¡®è®¤ï¼š
â–¡ å‹ç¼©åŒ…å®Œæ•´ä¸Šä¼ 
â–¡ è§£å‹æˆåŠŸ
â–¡ æ–‡ä»¶æƒé™æ­£ç¡®
â–¡ ç›®å½•ç»“æ„å®Œæ•´

## ğŸš€ ä¸‹ä¸€æ­¥

ä¸Šä¼ å®Œæˆåï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤éƒ¨ç½²ï¼š

1. è§£å‹é¡¹ç›®
   ```bash
   tar -xzf end.tar.gz && cd end
   ```

2. æ·»åŠ æ‰§è¡Œæƒé™
   ```bash
   chmod +x deploy.sh
   ```

3. æ£€æŸ¥ç¯å¢ƒ
   ```bash
   ./deploy.sh check
   ```

4. å¯åŠ¨æœåŠ¡
   ```bash
   ./deploy.sh start
   ```

5. éªŒè¯éƒ¨ç½²
   ```bash
   ./deploy.sh test
   ```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ `SERVER_DEPLOYMENT.md`
